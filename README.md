# Medical Entity and Relation Annotation Tool

This project is a web-based tool for medical experts to annotate medical entities and relationships in clinical narratives. The annotations can be exported for use in healthcare NLP model training and evaluation.

For deeper technical details (architecture, data model, extensibility), see [`docs/design.md`](docs/design.md).

## Project Folder Structure

```
MedicalAnnotationTool/
│
├── backend/                      # FastAPI backend
│   └── app/
│       ├── main.py               # API + models + persistence
│       └── suggestion_service.py # Heuristic entity suggestions
│   └── requirements.txt
│
├── frontend/                     # Minimal static UI
│   └── index.html
│
├── data/
│   ├── raw/                      # Source text abstracts (.txt)
│   ├── annotations/              # Saved JSON annotations (generated)
│   └── vocab.json                # Controlled vocab
│
├── docs/
│   └── design.md                 # Architecture & data model
│
├── scripts/                      # (empty placeholder)
│
├── secrets/                      # Provided challenge instructions (not for prod)
│   └── *.txt
│
├── tests/                        # Pytest suite
│   ├── test_api.py
│   ├── test_persistence.py
│   └── test_suggestions.py
│
├── docker-compose.yml            # Local orchestration
├── Dockerfile                    # Container image build
├── .gitignore
└── README.md
```

## Quick Start (Local with Docker)

Prerequisites: Docker Desktop.

1. Clone the repository.
2. Build and start the backend container:
	```powershell
	docker compose up --build
	```
3. Verify health endpoint:
	```powershell
	curl http://localhost:8000/health
	```
4. Explore the autogenerated docs (FastAPI): http://localhost:8000/docs
5. (Optional UI) Open minimal interface: http://localhost:8000/ui/
6. Load sample abstracts (first time only; POST or simple GET):
	```powershell
	curl -X POST http://localhost:8000/bootstrap
	# or
	curl http://localhost:8000/bootstrap
	```
7. Explore the controlled vocabulary: http://localhost:8000/vocab
8. List loaded documents:
	```powershell
	curl http://localhost:8000/documents
	```
9. (Optional) Get heuristic suggestions for a document:
	```powershell
	curl "http://localhost:8000/suggest/entities?doc_id=abstract1"
	```
10. (Optional) Stop containers:
	```powershell
	docker compose down
	```

## API Summary (Initial Backend)
Endpoints (subject to change as frontend is added):
- POST /documents
- GET /documents
- GET /documents/{id}
- POST /documents/{id}/entities
- POST /documents/{id}/relations
- GET /documents/{id}/export
- POST /import (upload JSON export)
- GET /health
- GET /vocab (controlled entity/relation types)
- POST /bootstrap (ingest raw abstracts into documents)
- GET /suggest/entities (heuristic entity suggestions)
- POST /save/all (force save all documents)
- DELETE /documents/{id}/entities/{entity_id}
- DELETE /documents/{id}/relations/{relation_id}
- PATCH /documents/{id}/status (body: {"status":"completed" | "in_progress" | ...})

Example workflow (single document):
1. POST /bootstrap
2. GET /documents -> pick an id (e.g., abstract1)
3. Add entity:
	```powershell
	curl -X POST http://localhost:8000/documents/abstract1/entities ^
	  -H "Content-Type: application/json" ^
	  -d "{\"start\":0,\"end\":12,\"text\":\"Hypertension\",\"type\":\"Disease\"}"
	```
4. Create relation (needs two entity IDs — retrieve via GET /documents/{id}):
	```powershell
	curl -X POST http://localhost:8000/documents/abstract1/relations ^
	  -H "Content-Type: application/json" ^
	  -d "{\"source_entity_id\":\"<eid1>\",\"target_entity_id\":\"<eid2>\",\"relation_type\":\"treats\"}"
	```
5. Export annotated document:
	```powershell
	curl http://localhost:8000/documents/abstract1/export
	```

Persistence: documents auto-save to data/annotations/*.json after create, entity add, relation add, or import. Bootstrap reloads saved JSON if present.

## Minimal Web UI Usage

Open http://localhost:8000/ui/ after the container is running. Then:

1. Click "Bootstrap Documents" to load sample abstracts (first run).
2. Choose a document from the drop-down.
3. Highlight text in the Document Text panel; click "Add Entity". It appears in the Entities list and is highlighted in the text.
4. To create a relation: check exactly two entity checkboxes, pick a relation type, click "Create Relation".
5. Click "Suggest Entities" to fetch heuristic suggestions; press "Add" on any suggestion to accept it.
6. Click "Export JSON" to view the current document's raw annotation JSON in the Export panel.
7. Press "Save All" anytime to force persistence of all loaded documents (auto-save also happens on each add action).
8. Remove an entity or relation using the small ✕ button (after deletion re-select entities if creating a relation).

Status messages appear at the top; all saved JSON files land in `data/annotations/`.

## Roadmap (Time-Constrained)
Phase 1 (done): Backend scaffold + Docker.
Phase 2: Minimal frontend (document view, entity selection, relation linking).
Phase 3: Export/import polish + sample dataset.
Phase 4 (later): Reintroduce Terraform + Azure hosting and optional LLM suggestions.
\- See `docs/design.md` for future improvement list and extensibility notes.

